syntax = "proto3";

package otp;
option go_package = "github.com/yasinsaee/go-user-service/otppb";

// OTP type enum
enum OTPType {
  FORGOT_PASSWORD = 0;
  REGISTER = 1;
  EMAIL_VERIFICATION = 2;
}

// OTP structure
message OTP {
  string id = 1;
  string receiver = 2;     
  string code = 3;
  int64 expiresAt = 4;
  bool used = 5;
  OTPType type = 6;      
}

// CRUD
message CreateOTPRequest {
  string receiver = 1;
  string code = 2;
  OTPType type = 3;
  int32 ttlSeconds = 4;
}
message CreateOTPResponse { OTP otp = 1; }

message UpdateOTPRequest {
  string id = 1;
  string code = 2;
  int32 ttlSeconds = 3;
  bool used = 4;
  OTPType type = 5;
}
message UpdateOTPResponse { OTP otp = 1; }

message DeleteOTPRequest { string id = 1; }
message DeleteOTPResponse { string message = 1; }

message GetOTPRequest { string id = 1; }
message GetOTPResponse { OTP otp = 1; }

message ListOTPsRequest {}
message ListOTPsResponse { repeated OTP otps = 1; }

// Business Logic (Request / Validate OTP)
message RequestOTPRequest {
  string receiver = 1;   
  OTPType type = 2;    
  int32 ttlSeconds = 3;
}
message RequestOTPResponse {
  string message = 1;
}

message ValidateOTPRequest {
  string receiver = 1;
  string code = 2;
  OTPType type = 3;   
}
message ValidateOTPResponse { bool valid = 1; }

// OTP Service
service OTPService {
  // CRUD
  rpc CreateOTP(CreateOTPRequest) returns (CreateOTPResponse);
  rpc UpdateOTP(UpdateOTPRequest) returns (UpdateOTPResponse);
  rpc DeleteOTP(DeleteOTPRequest) returns (DeleteOTPResponse);
  rpc GetOTP(GetOTPRequest) returns (GetOTPResponse);
  rpc ListOTPs(ListOTPsRequest) returns (ListOTPsResponse);

  // Business logic
  rpc RequestOTP(RequestOTPRequest) returns (RequestOTPResponse);
  rpc ValidateOTP(ValidateOTPRequest) returns (ValidateOTPResponse);
}
