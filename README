$protoRoot = Join-Path (Get-Location) "proto"
$serviceProtoRoot = Join-Path $protoRoot "user-service" #inventory-service and .....

$protoFiles = Get-ChildItem -Recurse -Path $serviceProtoRoot -Filter *.proto

foreach ($file in $protoFiles) {
    $relativePath = $file.FullName.Substring($protoRoot.Length + 1) -replace '\\','/'

    protoc -I="$protoRoot" `
           --go_out=. --go_opt=paths=source_relative `
           --go-grpc_out=. --go-grpc_opt=paths=source_relative "$relativePath"
}



#without filter


$protoRoot = Join-Path (Get-Location) "proto"
$protoFiles = Get-ChildItem -Recurse -Path $protoRoot -Filter *.proto

foreach ($file in $protoFiles) {
    # مسیر نسبی نسبت به فولدر proto و با اسلش درست
    $relativePath = $file.FullName.Substring($protoRoot.Length + 1) -replace '\\','/'

    protoc -I="$protoRoot" `
           --go_out=. --go_opt=paths=source_relative `
           --go-grpc_out=. --go-grpc_opt=paths=source_relative "$relativePath"
}

#UBUNTU
#!/bin/bash

protoRoot="$(pwd)/proto"

# Find all .proto files recursively
protoFiles=$(find "$protoRoot" -name "*.proto")

for file in $protoFiles; do
    # Get relative path
    relativePath="${file#$protoRoot/}"

    # Run protoc
    protoc -I="$protoRoot" \
           --go_out=. --go_opt=paths=source_relative \
           --go-grpc_out=. --go-grpc_opt=paths=source_relative \
           "$relativePath"
done
